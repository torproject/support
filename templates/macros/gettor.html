{% macro gettor_email() %}
<div>
  <label>
    Select your operating system:
    <select class="os-select">
      <option value="windows">{{ _('Windows') }}</option>
      <option value="macos">{{ _('MacOS') }}</option>
      <option value="linux">{{ _('Linux') }}</option>
    </select>
  </label>
  <br>
  <a href="mailto:gettor@torproject.org?body=windows" class="mailto">{{ _('Click here to email gettor') }}</a>
</div>
{% endmacro %}

{% macro gettor_email_script() %}
<script>
    let osName = "windows";
    switch((window.navigator.userAgentData || {platform: ''}).platform.toLowerCase()) {
      case 'windows':
        osName = 'windows';
        break;
      case 'macos':
        osName = 'macos';
        break;
      case 'linux':
        osName = 'linux';
        break;
      default:
        let ua = window.navigator.userAgent.toLowerCase()
        if (ua.includes('windows')) {
          osName = 'windows';
        } else if (ua.includes('linux')) {
          osName = 'linux';
        } else if (ua.includes('mac')) {
          osName = 'macos';
        }
      }

  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.gettor-email').forEach(div => {
        div.style.display = 'inline-block';
        let template = document.createElement('template');
        template.innerHTML = `{{ gettor_email() }}`.trim();
        div.append(...template.content.children);
      });
      document.querySelectorAll('.gettor-email .os-select').forEach(select => {
          select.addEventListener('change', (event) => {console.log(event); event.target.parentElement.getElementsByClassName('mailto')[0].href=`mailto:gettor@torproject.org?body=${event.target.value}`;});
          select.value = osName;
          select.parentElement.getElementsByClassName('mailto')[0].href=`mailto:gettor@torproject.org?body=${osName}`;
        });
  });
</script>
{% endmacro %}
